# Finance Tracker - Docker Compose Development Override
# Version: 1.0 | Milestone 1
# Use: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d

services:
  postgres:
    environment:
      # Development credentials (override in production)
      POSTGRES_USER: dev_user
      POSTGRES_PASSWORD: dev_password
      POSTGRES_DB: finance_tracker_dev
    ports:
      - "5433:5432"
    # Enable logging for development
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

  minio:
    environment:
      MINIO_ROOT_USER: devadmin
      MINIO_ROOT_PASSWORD: devadmin123
    ports:
      - "9002:9000"
      - "9003:9001"

  redis:
    command: redis-server --appendonly yes --requirepass dev_redis_password
    ports:
      - "6380:6379"

  # Backend service for development (hot reload)
  backend:
    build:
      context: ../backend
      dockerfile: build/docker/Dockerfile.dev
    container_name: finance-tracker-backend-dev
    restart: unless-stopped
    environment:
      - ENV=development
      - SERVER_PORT=8080
      - DATABASE_URL=postgres://dev_user:dev_password@postgres:5432/finance_tracker_dev?sslmode=disable
      - REDIS_URL=redis://:dev_redis_password@redis:6379/0
      - MINIO_ENDPOINT=minio:9000
      - MINIO_ACCESS_KEY=devadmin
      - MINIO_SECRET_KEY=devadmin123
      - MINIO_BUCKET=finance-tracker-uploads
      - MINIO_USE_SSL=false
      - JWT_SECRET=dev-jwt-secret-change-in-production
      - JWT_EXPIRY=15m
      - REFRESH_TOKEN_EXPIRY=7d
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
    ports:
      - "8080:8080"
    volumes:
      - ../backend:/app
      - /app/tmp
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      minio:
        condition: service_healthy
    networks:
      - finance-tracker-network
    profiles:
      - backend

  # Frontend service for development
  frontend:
    build:
      context: ../frontend
      dockerfile: Dockerfile.dev
    container_name: finance-tracker-frontend-dev
    restart: unless-stopped
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_API_URL=http://localhost:8080/api/v1
    ports:
      - "3100:3000"
    volumes:
      - ../frontend:/app
      - /app/node_modules
      - /app/.next
    depends_on:
      - backend
    networks:
      - finance-tracker-network
    profiles:
      - frontend
